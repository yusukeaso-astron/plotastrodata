

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>plotastrodata.plot_utils &mdash; plotastrodata 1.4.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=9172181d"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            plotastrodata
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../plotastrodata.html">plotastrodata package</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">plotastrodata</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">plotastrodata.plot_utils</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for plotastrodata.plot_utils</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="kn">import</span> <span class="n">Ellipse</span><span class="p">,</span> <span class="n">Rectangle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">plotastrodata.coord_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">coord2xy</span><span class="p">,</span> <span class="n">xy2coord</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">plotastrodata.other_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">listing</span><span class="p">,</span> <span class="n">estimate_rms</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">plotastrodata.analysis_utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">AstroData</span><span class="p">,</span> <span class="n">AstroFrame</span>


<span class="n">plt</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>  <span class="c1"># force to turn off interactive mode</span>


<div class="viewcode-block" id="set_rcparams">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.set_rcparams">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_rcparams</span><span class="p">(</span><span class="n">fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">18</span><span class="p">,</span> <span class="n">nancolor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span>
                 <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Nice rcParams for figures.</span>

<span class="sd">    Args:</span>
<span class="sd">        fontsize (int, optional): plt.rcParams[&#39;font.size&#39;]. Defaults to 18.</span>
<span class="sd">        nancolor (str, optional): plt.rcParams[&#39;axes.facecolor&#39;]. Defaults to &#39;w&#39;.</span>
<span class="sd">        dpi (int, optional): plt.rcParams[&#39;savefig.dpi&#39;]. Defaults to 256.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># plt.rcParams[&#39;font.family&#39;] = &#39;arial&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.facecolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">nancolor</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fontsize</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dpi</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;legend.fontsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;axes.linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.direction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;inout&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.direction&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;inout&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.top&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.right&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.major.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.major.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.minor.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.minor.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.major.width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.major.width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.minor.width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.minor.width&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.5</span></div>



<div class="viewcode-block" id="logticks">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.logticks">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">logticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">lim</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
             <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make nice ticks for a log axis.</span>

<span class="sd">    Args:</span>
<span class="sd">        ticks (list): List of ticks.</span>
<span class="sd">        lim (list): [min, max].</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: (new ticks, new labels).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">order</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]))))</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">10</span><span class="o">**</span><span class="n">order</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">order</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">order</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">order</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]))))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">lim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">10</span><span class="o">**</span><span class="n">order</span><span class="p">)</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">order</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="n">order</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">newticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">ticks</span><span class="p">,</span> <span class="n">b</span><span class="p">]))</span>
    <span class="n">newlabels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">newticks</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">newticks</span><span class="p">,</span> <span class="n">newlabels</span></div>



<div class="viewcode-block" id="PlotAxes2D">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAxes2D">[docs]</a>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PlotAxes2D</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use Axes.set_* to adjust x and y axes.</span>

<span class="sd">    Args:</span>
<span class="sd">        samexy (bool, optional): True supports same ticks between x and y. Defaults to True.</span>
<span class="sd">        loglog (float, optional): If a float is given, plot on a log-log plane, and xim=(xmax / loglog, xmax) and so does ylim. Defaults to None.</span>
<span class="sd">        xscale (str, optional): Defaults to None.</span>
<span class="sd">        yscale (str, optional): Defaults to None.</span>
<span class="sd">        xlim (list, optional): Defaults to None.</span>
<span class="sd">        ylim (list, optional): Defaults to None.</span>
<span class="sd">        xlabel (str, optional): Defaults to None.</span>
<span class="sd">        ylabel (str, optional): Defaults to None.</span>
<span class="sd">        xticks (list, optional): Defaults to None.</span>
<span class="sd">        yticks (list, optional): Defaults to None.</span>
<span class="sd">        xticklabels (list, optional): Defaults to None.</span>
<span class="sd">        yticklabels (list, optional): Defaults to None.</span>
<span class="sd">        xticksminor (list or int, optional): If int, int times more than xticks. Defaults to None.</span>
<span class="sd">        yticksminor (list or int, optional): Defaults to None. If int, int times more than xticks. Defaults to None.</span>
<span class="sd">        grid (dict, optional): True means merely grid(). Defaults to None.</span>
<span class="sd">        aspect (dict or float, optional): Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">samexy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">loglog</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">xscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
    <span class="n">yscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
    <span class="n">xlim</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ylim</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">xticks</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">yticks</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">xticklabels</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">yticklabels</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">xticksminor</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">yticksminor</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">grid</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">aspect</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="PlotAxes2D.set_xyaxes">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAxes2D.set_xyaxes">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_xyaxes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglog</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xscale</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yscale</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">samexy</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglog</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">loglog</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xscale</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yscale</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">samexy</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">())</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">())</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xticks</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xscale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xticks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xticklabels</span> \
                    <span class="o">=</span> <span class="n">logticks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xticks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlim</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">yticks</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yscale</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yticks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">yticklabels</span> \
                    <span class="o">=</span> <span class="n">logticks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yticks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylim</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yticks</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xticksminor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xticksminor</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">()</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span><span class="p">]</span>
                <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xticksminor</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">xticksminor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">num</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xticksminor</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yticksminor</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yticksminor</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">()</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span><span class="p">]</span>
                <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">yticksminor</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">yticksminor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">num</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yticksminor</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xticklabels</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yticklabels</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xlim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">xlim</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ylim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">ylim</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="o">**</span><span class="p">({}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aspect</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aspect</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="set_minmax">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.set_minmax">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">set_minmax</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">stretch</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">stretchscale</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
               <span class="n">stretchpower</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
               <span class="n">rms</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">kw</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set vmin and vmax for color pcolormesh and RGB maps.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (np.ndarray): Plotted data.</span>
<span class="sd">        stretch (str): &#39;log&#39;, &#39;asinh&#39;, &#39;power&#39;. Any other means linear.</span>
<span class="sd">        stretchscale (float): For the arcsinh strech.</span>
<span class="sd">        stretchpower (float): For the power strech.</span>
<span class="sd">        rms (float): RMS noise level.</span>
<span class="sd">        kw (dict): Probably like {&#39;vmin&#39;:0, &#39;vmax&#39;:1}.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Data clipped with the vmin and vmax.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">stretch</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data</span><span class="p">]</span>
        <span class="n">rms</span> <span class="o">=</span> <span class="p">[</span><span class="n">rms</span><span class="p">]</span>
        <span class="n">stretch</span> <span class="o">=</span> <span class="p">[</span><span class="n">stretch</span><span class="p">]</span>
        <span class="n">stretchscale</span> <span class="o">=</span> <span class="p">[</span><span class="n">stretchscale</span><span class="p">]</span>
        <span class="k">if</span> <span class="s1">&#39;vmin&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="s1">&#39;vmax&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">stretch</span><span class="p">,</span> <span class="n">stretchscale</span><span class="p">,</span> <span class="n">rms</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">stsc</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">z</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">stsc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stsc</span> <span class="o">=</span> <span class="n">r</span>
        <span class="k">if</span> <span class="n">st</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">c</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]),</span> <span class="kc">None</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">st</span> <span class="o">==</span> <span class="s1">&#39;asinh&#39;</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">(</span><span class="n">c</span> <span class="o">/</span> <span class="n">stsc</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">st</span> <span class="o">==</span> <span class="s1">&#39;power&#39;</span><span class="p">:</span>
            <span class="n">cmin</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;vmin&#39;</span> <span class="ow">in</span> <span class="n">kw</span> <span class="k">else</span> <span class="n">r</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">cmin</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">c</span> <span class="o">=</span> <span class="p">((</span><span class="n">c</span> <span class="o">/</span> <span class="n">cmin</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stretchpower</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> \
                <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stretchpower</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">,</span> <span class="s1">&#39;vmax&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">stsc</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">z</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">st</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                    <span class="n">kw</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                <span class="k">elif</span> <span class="n">st</span> <span class="o">==</span> <span class="s1">&#39;asinh&#39;</span><span class="p">:</span>
                    <span class="n">kw</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">stsc</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">st</span> <span class="o">==</span> <span class="s1">&#39;power&#39;</span><span class="p">:</span>
                    <span class="n">kw</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">kw</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">c</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stretchpower</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> \
                               <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stretchpower</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kw</span><span class="p">[</span><span class="n">m</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">st</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">z</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">m</span> <span class="o">==</span> <span class="s1">&#39;vmin&#39;</span><span class="p">:</span>

                    <span class="n">kw</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">if</span> <span class="n">st</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">kw</span><span class="p">[</span><span class="n">m</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">],</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])]</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">data</span></div>



<div class="viewcode-block" id="kwargs2AstroData">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.kwargs2AstroData">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">kwargs2AstroData</span><span class="p">(</span><span class="n">kw</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AstroData</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get AstroData and remove its arguments from kwargs.</span>

<span class="sd">    Args:</span>
<span class="sd">        kw (dict): Parameters to make AstroData.</span>

<span class="sd">    Returns:</span>
<span class="sd">        AstroData: AstroData made from the parameters in kwargs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">AstroData</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">tmp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">tmp</span> <span class="o">==</span> <span class="p">{}:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No argument given.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">AstroData</span><span class="p">(</span><span class="o">**</span><span class="n">tmp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div>



<div class="viewcode-block" id="kwargs2AstroFrame">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.kwargs2AstroFrame">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">kwargs2AstroFrame</span><span class="p">(</span><span class="n">kw</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AstroFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get AstroFrame from kwargs.</span>

<span class="sd">    Args:</span>
<span class="sd">        kw (dict): Parameters to make AstroFrame.</span>

<span class="sd">    Returns:</span>
<span class="sd">        AstroFrame: AstroFrame made from the parameters in kwargs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">AstroFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">tmp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">AstroFrame</span><span class="p">(</span><span class="o">**</span><span class="n">tmp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span></div>



<div class="viewcode-block" id="kwargs2PlotAxes2D">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.kwargs2PlotAxes2D">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">kwargs2PlotAxes2D</span><span class="p">(</span><span class="n">kw</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PlotAxes2D</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get PlotAxes2D and remove its arguments from kwargs.</span>

<span class="sd">    Args:</span>
<span class="sd">        kw (dict): Parameters to make PlotAxes2D.</span>

<span class="sd">    Returns:</span>
<span class="sd">        PlotAxes2D: PlotAxes2D made from the parameters in kwargs.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">PlotAxes2D</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">tmp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">PlotAxes2D</span><span class="p">(</span><span class="o">**</span><span class="n">tmp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span></div>



<div class="viewcode-block" id="kwargs2beamargs">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.kwargs2beamargs">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">kwargs2beamargs</span><span class="p">(</span><span class="n">kw</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get arguments for add_beam() from kwargs.</span>

<span class="sd">    Args:</span>
<span class="sd">        kw (dict): Parameters to make beam.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: Arguments for add_beam().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;show_beam&#39;</span><span class="p">,</span> <span class="s1">&#39;beamcolor&#39;</span><span class="p">,</span> <span class="s1">&#39;beampos&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
            <span class="n">tmp</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;beam_kwargs&#39;</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">:</span>
        <span class="n">tmp</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s1">&#39;beam_kwargs&#39;</span><span class="p">])</span>
        <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="s1">&#39;beam_kwargs&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">tmp</span></div>



<div class="viewcode-block" id="PlotAstroData">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAstroData">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PlotAstroData</span><span class="p">(</span><span class="n">AstroFrame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make a figure from 2D/3D FITS files or 2D/3D arrays.</span>

<span class="sd">    Basic rules ---</span>
<span class="sd">    For 3D data, a 1D velocity array or a FITS file with a velocity axis must be given to set up channels in each page.</span>
<span class="sd">    For 2D/3D data, the spatial center can be read from a FITS file or manually given.</span>
<span class="sd">    len(v)=1 (default) means to make a 2D figure.</span>
<span class="sd">    Spatial lengths are in the unit of arcsec, or au if dist (!= 1) is given.</span>
<span class="sd">    Angles are in the unit of degree.</span>
<span class="sd">    For region, line, arrow, label, and marker, a single input can be treated without a list, e.g., anglelist=60, as well as anglelist=[60].</span>
<span class="sd">    Each element of poslist supposes a text coordinate like &#39;01h23m45.6s 01d23m45.6s&#39; or a list of relative x and y like [0.2, 0.3] (0 is left or bottom, 1 is right or top).</span>
<span class="sd">    Parameters for original methods in matplotlib.axes.Axes can be used as kwargs; see the default _kw for reference.</span>
<span class="sd">    Position-velocity diagrams (pv=True) does not yet suppot region, line, arrow, and segment because the units of abscissa and ordinate are different.</span>

<span class="sd">    kwargs is the arguments of AstroFrame to define plotting ranges.</span>

<span class="sd">    Args:</span>
<span class="sd">        v (np.ndarray, optional): Used to set up channels if fitsimage not given. Defaults to [0].</span>
<span class="sd">        vskip (int, optional): How many channels are skipped. Defaults to 1.</span>
<span class="sd">        veldigit (int, optional): How many digits after the decimal point. Defaults to 2.</span>
<span class="sd">        restfreq (float, optional): Used for velocity and brightness T. Defaults to None.</span>
<span class="sd">        channelnumber (int, optional): Specify a channel number to make 2D maps. Defaults to None.</span>
<span class="sd">        nrows (int, optional): Used for channel maps. Defaults to 4.</span>
<span class="sd">        ncols (int, optional): Used for channel maps. Defaults to 6.</span>
<span class="sd">        fontsize (int, optional): rc_Params[&#39;font.size&#39;]. None means 18 (2D) or 12 (3D). Defaults to None.</span>
<span class="sd">        nancolor (str, optional): Color for masked regions. Defaults to white.</span>
<span class="sd">        dpi (int, optional): Dot per inch for plotting an image. Defaults to 256.</span>
<span class="sd">        figsize (tuple, optional): Defaults to None.</span>
<span class="sd">        fig (optional): External plt.figure(). Defaults to None.</span>
<span class="sd">        ax (optional): External fig.add_subplot(). Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">]),</span> <span class="n">vskip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="n">veldigit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">restfreq</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">channelnumber</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nrows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">ncols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
                 <span class="n">fontsize</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">nancolor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span>
                 <span class="n">figsize</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">fig</span><span class="p">:</span> <span class="nb">object</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="nb">object</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">internalfig</span> <span class="o">=</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="n">internalax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">channelnumber</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">nrows</span> <span class="o">=</span> <span class="n">ncols</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fitsimage</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">d</span> <span class="o">:=</span> <span class="n">AstroData</span><span class="p">(</span><span class="n">fitsimage</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">fitsimage</span><span class="p">,</span>
                                     <span class="n">restfreq</span><span class="o">=</span><span class="n">restfreq</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">))</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">v</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dv</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">k0</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">vmin</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">dv</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">k0</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">vpre</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">k0</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">dv</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vpre</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">k0</span><span class="p">:]</span>
            <span class="n">k1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">vmax</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dv</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">k1</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="n">vpost</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">k1</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span> <span class="o">*</span> <span class="n">dv</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">vpost</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="p">[:</span><span class="n">k1</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pv</span> <span class="ow">or</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">nv</span> <span class="o">=</span> <span class="n">nrows</span> <span class="o">=</span> <span class="n">ncols</span> <span class="o">=</span> <span class="n">npages</span> <span class="o">=</span> <span class="n">nchan</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nv</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span> <span class="o">:=</span> <span class="n">v</span><span class="p">[::</span><span class="n">vskip</span><span class="p">])</span>
            <span class="n">npages</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">nv</span> <span class="o">/</span> <span class="n">nrows</span> <span class="o">/</span> <span class="n">ncols</span><span class="p">))</span>
            <span class="n">nchan</span> <span class="o">=</span> <span class="n">npages</span> <span class="o">*</span> <span class="n">nrows</span> <span class="o">*</span> <span class="n">ncols</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">r_</span><span class="p">[</span><span class="n">v</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nchan</span><span class="o">-</span><span class="n">nv</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">channelnumber</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">nchan</span> <span class="o">=</span> <span class="n">npages</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">nij2ch</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">j</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">n</span><span class="o">*</span><span class="n">nrows</span><span class="o">*</span><span class="n">ncols</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">ncols</span> <span class="o">+</span> <span class="n">j</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">ch2nij</span><span class="p">(</span><span class="n">ch</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">ch</span> <span class="o">//</span> <span class="p">(</span><span class="n">nrows</span><span class="o">*</span><span class="n">ncols</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">ch</span> <span class="o">-</span> <span class="n">n</span><span class="o">*</span><span class="n">nrows</span><span class="o">*</span><span class="n">ncols</span><span class="p">)</span> <span class="o">//</span> <span class="n">ncols</span>
            <span class="n">j</span> <span class="o">=</span> <span class="n">ch</span> <span class="o">%</span> <span class="n">ncols</span>
            <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>

        <span class="k">if</span> <span class="n">fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">18</span> <span class="k">if</span> <span class="n">nchan</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">12</span>
        <span class="n">set_rcparams</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">nancolor</span><span class="o">=</span><span class="n">nancolor</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nchan</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">internalax</span> <span class="k">else</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">figsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sqrt_a</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span>
            <span class="n">sqrt_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sqrt_a</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">nchan</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">7</span> <span class="o">/</span> <span class="n">sqrt_a</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">sqrt_a</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="n">ncols</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">sqrt_a</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">nrows</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">sqrt_a</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nchan</span><span class="p">):</span>
            <span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">ch2nij</span><span class="p">(</span><span class="n">ch</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">internalfig</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
            <span class="n">sharex</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">nij2ch</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">)]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">sharey</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">nij2ch</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span> <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">internalax</span><span class="p">:</span>
                <span class="n">ax</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">ncols</span> <span class="o">+</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                                         <span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nchan</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">channelnumber</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.87</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.87</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ch</span> <span class="o">&lt;</span> <span class="n">nv</span><span class="p">:</span>
                    <span class="n">vellabel</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span> <span class="k">if</span> <span class="n">channelnumber</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">v</span><span class="p">[</span><span class="n">channelnumber</span><span class="p">]</span>
                    <span class="n">ax</span><span class="p">[</span><span class="n">ch</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.9</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmax</span><span class="p">,</span> <span class="mf">0.7</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmax</span><span class="p">,</span>
                                <span class="sa">rf</span><span class="s1">&#39;$</span><span class="si">{</span><span class="n">vellabel</span><span class="si">:</span><span class="s1">.</span><span class="si">{</span><span class="n">veldigit</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">f</span><span class="si">}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                                <span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">internalfig</span> <span class="k">else</span> <span class="n">fig</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rowcol</span> <span class="o">=</span> <span class="n">nrows</span> <span class="o">*</span> <span class="n">ncols</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npages</span> <span class="o">=</span> <span class="n">npages</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allchan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nv</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bottomleft</span> <span class="o">=</span> <span class="n">nij2ch</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npages</span><span class="p">),</span> <span class="n">nrows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span> <span class="o">=</span> <span class="n">channelnumber</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">vskipfill</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">v_in</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Skip and fill channels with nan.</span>

<span class="sd">            Args:</span>
<span class="sd">                c (np.ndarray): 2D or 3D arrays.</span>
<span class="sd">                v_in (np.ndarray): 1D array.</span>

<span class="sd">            Returns:</span>
<span class="sd">                np.ndarray: 3D arrays skipped and filled with nan.</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v_in</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">k0</span> <span class="o">:=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v</span> <span class="o">-</span> <span class="n">v_in</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">prenan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">k0</span><span class="p">,</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">c</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                        <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prenan</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">d</span> <span class="o">=</span> <span class="n">c</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">[::</span><span class="n">vskip</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">nv</span><span class="p">,</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">c</span><span class="p">)),</span> <span class="n">c</span><span class="p">)</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">nchan</span> <span class="k">if</span> <span class="n">channelnumber</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">nv</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
            <span class="n">dnan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">d</span><span class="p">,</span> <span class="n">dnan</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vskipfill</span> <span class="o">=</span> <span class="n">vskipfill</span>

<div class="viewcode-block" id="PlotAstroData.add_region">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAstroData.add_region">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_region</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">patch</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ellipse&#39;</span><span class="p">,</span>
                   <span class="n">poslist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[],</span>
                   <span class="n">majlist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">minlist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
                   <span class="n">palist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
                   <span class="n">include_chan</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use add_patch() and Rectangle or Ellipse of matplotlib.</span>

<span class="sd">        Args:</span>
<span class="sd">            patch (str, optional): &#39;ellipse&#39; or &#39;rectangle&#39;. Defaults to &#39;ellipse&#39;.</span>
<span class="sd">            poslist (list, optional): Text or relative center. Defaults to [].</span>
<span class="sd">            majlist (list, optional): Ellipse major axis. Defaults to [].</span>
<span class="sd">            minlist (list, optional): Ellipse minor axis. Defaults to [].</span>
<span class="sd">            palist (list, optional): Position angle (north to east). Defaults to [].</span>
<span class="sd">            include_chan (list, optional): None means all. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span>
               <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
        <span class="n">_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_chan</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">include_chan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allchan</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">patch</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rectangle&#39;</span><span class="p">,</span> <span class="s1">&#39;ellipse&#39;</span><span class="p">]):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Only patch=</span><span class="se">\&#39;</span><span class="s1">rectangle</span><span class="se">\&#39;</span><span class="s1"> or </span><span class="se">\&#39;</span><span class="s1">ellipse</span><span class="se">\&#39;</span><span class="s1"> supported. &#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">angle</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pos2xy</span><span class="p">(</span><span class="n">poslist</span><span class="p">),</span>
                                              <span class="o">*</span><span class="n">listing</span><span class="p">(</span><span class="n">minlist</span><span class="p">,</span> <span class="n">majlist</span><span class="p">,</span> <span class="n">palist</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">ch</span><span class="p">,</span> <span class="n">axnow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="n">ch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ch</span> <span class="ow">in</span> <span class="n">include_chan</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">ch</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowcol</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">patch</span> <span class="o">==</span> <span class="s1">&#39;rectangle&#39;</span><span class="p">:</span>
                    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
                    <span class="n">xp</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">width</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">height</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.</span>
                    <span class="n">yp</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="n">width</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">height</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">Rectangle</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
                    <span class="n">p</span> <span class="o">=</span> <span class="n">Ellipse</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="p">((</span><span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                      <span class="n">angle</span><span class="o">=</span><span class="n">angle</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">xdir</span><span class="p">,</span> <span class="o">**</span><span class="n">_kw</span><span class="p">)</span>
                <span class="n">axnow</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">p</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotAstroData.add_beam">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAstroData.add_beam">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_beam</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_beam</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">beam</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
                 <span class="n">beamcolor</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span>
                 <span class="n">beampos</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use add_region(). All the arguments may be a list of each format.</span>

<span class="sd">        Args:</span>
<span class="sd">            show_beam (bool, optional): Defaults to True.</span>
<span class="sd">            beam (list, optional): [bmaj, bmin, bpa]. This may be a list of list. Defaults to [None, None, None].</span>
<span class="sd">            beamcolor (str, optional): matplotlib color. This may be a list of str. Defaults to &#39;gray&#39;.</span>
<span class="sd">            beampos (list, optional): Relative position. This may be a list of list or a list of None. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">show_beam</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">include_chan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottomleft</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">allchan</span>
        <span class="n">patch</span> <span class="o">=</span> <span class="s1">&#39;rectangle&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pv</span> <span class="k">else</span> <span class="s1">&#39;ellipse&#39;</span>
        <span class="n">blist</span> <span class="o">=</span> <span class="p">[</span><span class="n">beam</span><span class="p">]</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">beam</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">beam</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">blist</span><span class="p">)</span>
        <span class="n">bclist</span> <span class="o">=</span> <span class="n">beamcolor</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">beamcolor</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="k">else</span> <span class="p">[</span><span class="n">beamcolor</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
        <span class="n">bplist</span> <span class="o">=</span> <span class="n">beampos</span> <span class="k">if</span> <span class="n">beampos</span> <span class="o">==</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">beampos</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="p">[</span><span class="n">beampos</span><span class="p">]</span> <span class="o">*</span> <span class="n">n</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">bmaj</span><span class="p">,</span> <span class="n">bmin</span><span class="p">,</span> <span class="n">bpa</span><span class="p">),</span> <span class="n">bc</span><span class="p">,</span> <span class="n">bp</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">blist</span><span class="p">,</span> <span class="n">bclist</span><span class="p">,</span> <span class="n">bplist</span><span class="p">):</span>
            <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">[</span><span class="n">bmaj</span><span class="p">,</span> <span class="n">bmin</span><span class="p">,</span> <span class="n">bpa</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;No beam to plot.&#39;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">a</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mf">0.35</span> <span class="o">*</span> <span class="n">bmaj</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmax</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">bp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">bp</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="mf">0.1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pv</span> <span class="k">else</span> <span class="n">a</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">swapxy</span><span class="p">:</span>
                <span class="n">bp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span>
                <span class="n">bpa</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">-</span> <span class="n">bpa</span>
            <span class="n">_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;facecolor&#39;</span><span class="p">:</span> <span class="n">bc</span><span class="p">,</span> <span class="s1">&#39;edgecolor&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
            <span class="n">_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_region</span><span class="p">(</span><span class="n">patch</span><span class="o">=</span><span class="n">patch</span><span class="p">,</span> <span class="n">poslist</span><span class="o">=</span><span class="n">bp</span><span class="p">,</span>
                            <span class="n">majlist</span><span class="o">=</span><span class="n">bmaj</span><span class="p">,</span> <span class="n">minlist</span><span class="o">=</span><span class="n">bmin</span><span class="p">,</span> <span class="n">palist</span><span class="o">=</span><span class="n">bpa</span><span class="p">,</span>
                            <span class="n">include_chan</span><span class="o">=</span><span class="n">include_chan</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">_kw</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotAstroData.add_marker">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAstroData.add_marker">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_marker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poslist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[],</span>
                   <span class="n">include_chan</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use Axes.plot of matplotlib.</span>

<span class="sd">        Args:</span>
<span class="sd">            poslist (list, optional): Text or relative. Defaults to [].</span>
<span class="sd">            include_chan (list, optional): None means all. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="s1">&#39;ms&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;mfc&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span>
               <span class="s1">&#39;mec&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="s1">&#39;mew&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
        <span class="n">_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_chan</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">include_chan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allchan</span>
        <span class="k">for</span> <span class="n">ch</span><span class="p">,</span> <span class="n">axnow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">ch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ch</span> <span class="ow">in</span> <span class="n">include_chan</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pos2xy</span><span class="p">(</span><span class="n">poslist</span><span class="p">)):</span>
                <span class="n">axnow</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="o">**</span><span class="n">_kw</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotAstroData.add_text">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAstroData.add_text">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poslist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">slist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">include_chan</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use Axes.text of matplotlib.</span>

<span class="sd">        Args:</span>
<span class="sd">            poslist (list, optional): Text or relative. Defaults to [].</span>
<span class="sd">            slist (list, optional): List of text. Defaults to [].</span>
<span class="sd">            include_chan (list, optional): None means all. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="s1">&#39;fontsize&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;ha&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span>
               <span class="s1">&#39;va&#39;</span><span class="p">:</span> <span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
        <span class="n">_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_chan</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">include_chan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allchan</span>
        <span class="k">for</span> <span class="n">ch</span><span class="p">,</span> <span class="n">axnow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">ch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ch</span> <span class="ow">in</span> <span class="n">include_chan</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pos2xy</span><span class="p">(</span><span class="n">poslist</span><span class="p">),</span> <span class="n">listing</span><span class="p">(</span><span class="n">slist</span><span class="p">)):</span>
                <span class="n">axnow</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s</span><span class="p">,</span> <span class="o">**</span><span class="n">_kw</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotAstroData.add_line">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAstroData.add_line">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poslist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">anglelist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">rlist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">include_chan</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use Axes.plot of matplotlib.</span>

<span class="sd">        Args:</span>
<span class="sd">            poslist (list, optional): Text or relative. Defaults to [].</span>
<span class="sd">            anglelist (list, optional): North to east. Defaults to [].</span>
<span class="sd">            rlist (list, optional): List of radius. Defaults to [].</span>
<span class="sd">            include_chan (list, optional): None means all. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">:</span> <span class="mf">1.5</span><span class="p">,</span>
               <span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
        <span class="n">_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_chan</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">include_chan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allchan</span>
        <span class="k">for</span> <span class="n">ch</span><span class="p">,</span> <span class="n">axnow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">ch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ch</span> <span class="ow">in</span> <span class="n">include_chan</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">alist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">anglelist</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pos2xy</span><span class="p">(</span><span class="n">poslist</span><span class="p">),</span> <span class="o">*</span><span class="n">listing</span><span class="p">(</span><span class="n">alist</span><span class="p">,</span> <span class="n">rlist</span><span class="p">)):</span>
                <span class="n">axnow</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">)],</span>
                           <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">)],</span> <span class="o">**</span><span class="n">_kw</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotAstroData.add_arrow">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAstroData.add_arrow">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_arrow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">poslist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[],</span>
                  <span class="n">anglelist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
                  <span class="n">rlist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">include_chan</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use Axes.quiver of matplotlib.</span>

<span class="sd">        Args:</span>
<span class="sd">            poslist (list, optional): Text or relative. Defaults to [].</span>
<span class="sd">            anglelist (list, optional): North to east. Defaults to [].</span>
<span class="sd">            rlist (list, optional): List of radius. Defaults to [].</span>
<span class="sd">            include_chan (list, optional): None means all. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mf">0.012</span><span class="p">,</span>
               <span class="s1">&#39;headwidth&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;headlength&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>
        <span class="n">_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">include_chan</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">include_chan</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allchan</span>
        <span class="k">for</span> <span class="n">ch</span><span class="p">,</span> <span class="n">axnow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">ch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ch</span> <span class="ow">in</span> <span class="n">include_chan</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">alist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">anglelist</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">pos2xy</span><span class="p">(</span><span class="n">poslist</span><span class="p">),</span> <span class="o">*</span><span class="n">listing</span><span class="p">(</span><span class="n">alist</span><span class="p">,</span> <span class="n">rlist</span><span class="p">)):</span>
                <span class="n">axnow</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">r</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">a</span><span class="p">),</span>
                             <span class="n">angles</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">scale_units</span><span class="o">=</span><span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">_kw</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotAstroData.add_scalebar">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAstroData.add_scalebar">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_scalebar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">length</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                     <span class="n">color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">barpos</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.12</span><span class="p">),</span>
                     <span class="n">fontsize</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">linewidth</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>
                     <span class="n">bbox</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use Axes.text and Axes.plot of matplotlib.</span>

<span class="sd">        Args:</span>
<span class="sd">            length (float, optional): In the unit of arcsec. Defaults to 0.</span>
<span class="sd">            label (str, optional): Text like &#39;100 au&#39;. Defaults to &#39;&#39;.</span>
<span class="sd">            color (str, optional): Same for bar and label. Defaults to &#39;gray&#39;.</span>
<span class="sd">            barpos (tuple, optional): Relative position. Defaults to (0.8, 0.12).</span>
<span class="sd">            fontsize (float, optional): None means 15 if one channel else 20. Defaults to None.</span>
<span class="sd">            linewidth (float, optional): Width of the bar. Defaults to 3.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please input length to add_scalebar().&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">20</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">15</span>
        <span class="k">for</span> <span class="n">ch</span><span class="p">,</span> <span class="n">axnow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottomleft</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos2xy</span><span class="p">([</span><span class="n">barpos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">barpos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.012</span><span class="p">])</span>
            <span class="n">axnow</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                       <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">bbox</span><span class="o">=</span><span class="n">bbox</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos2xy</span><span class="p">([</span><span class="n">barpos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">barpos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.012</span><span class="p">])</span>
            <span class="n">axnow</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">length</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">length</span><span class="o">/</span><span class="mf">2.</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                       <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotAstroData.add_color">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAstroData.add_color">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xskip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">yskip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="n">stretch</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                  <span class="n">stretchscale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">stretchpower</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                  <span class="n">show_cbar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">cblabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">cbformat</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%.1e</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">cbticks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                  <span class="n">cbticklabels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">cblocation</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span>
                  <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use Axes.pcolormesh of matplotlib. kwargs must include the arguments of AstroData to specify the data to be plotted. kwargs may include arguments for add_beam() and a dict of beam_kwargs to specify the beam patch in more detail.</span>

<span class="sd">        Args:</span>
<span class="sd">            xskip, yskip (int, optional): Spatial pixel skip. Defaults to 1.</span>
<span class="sd">            stretch (str, optional): &#39;log&#39; means the mapped data are logarithmic. &#39;asinh&#39; means the mapped data are arc sin hyperbolic. &#39;power&#39; means the mapped data are power-law (see also stretchpower). Defaults to &#39;linear&#39;.</span>
<span class="sd">            stretchscale (float, optional): color scale is asinh(data / stretchscale). Defaults to None.</span>
<span class="sd">            stretchpower (float, optional): color scale is ((data / vmin)**(1 - stretchpower) - 1) / (1 - stretchpower) / ln(10). 0 means the linear scale. 1 means the logarithmic scale. Defaults to 0.</span>
<span class="sd">            show_cbar (bool, optional): Show color bar. Defaults to True.</span>
<span class="sd">            cblabel (str, optional): Colorbar label. Defaults to None.</span>
<span class="sd">            cbformat (float, optional): Format for ticklabels of colorbar. Defaults to &#39;%.1e&#39;.</span>
<span class="sd">            cbticks (list, optional): Ticks of colorbar. Defaults to None.</span>
<span class="sd">            cbticklabels (list, optional): Ticklabels of colorbar. Defaults to None.</span>
<span class="sd">            cblocation (str, optional): &#39;left&#39;, &#39;top&#39;, &#39;left&#39;, &#39;right&#39;. Only for 2D images. Defaults to &#39;right&#39;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="s1">&#39;cubehelix&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;edgecolors&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
        <span class="n">beam_kwargs</span> <span class="o">=</span> <span class="n">kwargs2beamargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">kwargs2AstroData</span><span class="p">(</span><span class="n">_kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">xskip</span><span class="p">,</span> <span class="n">yskip</span><span class="p">)</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">beam</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">beam</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">sigma</span>
        <span class="n">bunit</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">bunit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beam</span> <span class="o">=</span> <span class="n">beam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span>
        <span class="k">if</span> <span class="n">stretchscale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">stretchscale</span> <span class="o">=</span> <span class="n">sigma</span>
        <span class="n">cmin_org</span> <span class="o">=</span> <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;vmin&#39;</span> <span class="ow">in</span> <span class="n">_kw</span> <span class="k">else</span> <span class="n">sigma</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">set_minmax</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">stretch</span><span class="p">,</span> <span class="n">stretchscale</span><span class="p">,</span> <span class="n">stretchpower</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">_kw</span><span class="p">)</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vskipfill</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">axnow</span><span class="p">,</span> <span class="n">cnow</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">axnow</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cnow</span><span class="p">,</span> <span class="o">**</span><span class="n">_kw</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottomleft</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">show_cbar</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="k">if</span> <span class="n">cblabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cblabel</span> <span class="o">=</span> <span class="n">bunit</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">ch</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">rowcol</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">cblabel</span><span class="p">,</span>
                                  <span class="nb">format</span><span class="o">=</span><span class="n">cbformat</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="n">cblocation</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.88</span><span class="p">,</span> <span class="mf">0.105</span><span class="p">,</span> <span class="mf">0.015</span><span class="p">,</span> <span class="mf">0.77</span><span class="p">])</span>
                <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">cblabel</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="n">cbformat</span><span class="p">)</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
            <span class="n">font</span> <span class="o">=</span> <span class="n">mpl</span><span class="o">.</span><span class="n">font_manager</span><span class="o">.</span><span class="n">FontProperties</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
            <span class="n">cb</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_font_properties</span><span class="p">(</span><span class="n">font</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cbticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">stretch</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                    <span class="n">cbticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">cbticks</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">stretch</span> <span class="o">==</span> <span class="s1">&#39;asinh&#39;</span><span class="p">:</span>
                    <span class="n">cbticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cbticks</span><span class="p">)</span> <span class="o">/</span> <span class="n">stretchscale</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">stretch</span> <span class="o">==</span> <span class="s1">&#39;power&#39;</span><span class="p">:</span>
                    <span class="n">cbticks</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cbticks</span><span class="p">)</span> <span class="o">/</span> <span class="n">cmin_org</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stretchpower</span><span class="p">)</span>
                    <span class="n">cbticks</span> <span class="o">=</span> <span class="p">(</span><span class="n">cbticks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stretchpower</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">cbticks</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">cbticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">(</span><span class="n">cbticklabels</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">stretch</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="s1">&#39;asinh&#39;</span><span class="p">,</span> <span class="s1">&#39;power&#39;</span><span class="p">]:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="n">get_ticks</span><span class="p">()</span>
                <span class="n">t</span> <span class="o">=</span> <span class="n">t</span><span class="p">[(</span><span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])]</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">stretch</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                    <span class="n">ticklin</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">t</span>
                <span class="k">elif</span> <span class="n">stretch</span> <span class="o">==</span> <span class="s1">&#39;asinh&#39;</span><span class="p">:</span>
                    <span class="n">ticklin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">*</span> <span class="n">stretchscale</span>
                <span class="k">elif</span> <span class="n">stretch</span> <span class="o">==</span> <span class="s1">&#39;power&#39;</span><span class="p">:</span>
                    <span class="n">ticklin</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stretchpower</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="n">t</span>
                    <span class="n">ticklin</span> <span class="o">=</span> <span class="n">cmin_org</span> <span class="o">*</span> <span class="n">ticklin</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">stretchpower</span><span class="p">))</span>
                <span class="n">cb</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">d</span><span class="si">:{</span><span class="n">cbformat</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="si">}}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">ticklin</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_beam</span><span class="p">(</span><span class="n">beam</span><span class="o">=</span><span class="n">beam</span><span class="p">,</span> <span class="o">**</span><span class="n">beam_kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotAstroData.add_contour">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAstroData.add_contour">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_contour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xskip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">yskip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">levels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">384</span><span class="p">],</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use Axes.contour of matplotlib. kwargs must include the arguments of AstroData to specify the data to be plotted. kwargs may include arguments for add_beam() and a dict of beam_kwargs to specify the beam patch in more detail.</span>

<span class="sd">        Args:</span>
<span class="sd">            xskip, yskip (int, optional): Spatial pixel skip. Defaults to 1.</span>
<span class="sd">            levels (list, optional): Contour levels in the unit of sigma. Defaults to [-12,-6,-3,3,6,12,24,48,96,192,384].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;colors&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidths&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
        <span class="n">beam_kwargs</span> <span class="o">=</span> <span class="n">kwargs2beamargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">kwargs2AstroData</span><span class="p">(</span><span class="n">_kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">xskip</span><span class="p">,</span> <span class="n">yskip</span><span class="p">)</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">beam</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">beam</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">sigma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beam</span> <span class="o">=</span> <span class="n">beam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span>
        <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vskipfill</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">axnow</span><span class="p">,</span> <span class="n">cnow</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="n">axnow</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">cnow</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">,</span> <span class="o">**</span><span class="n">_kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_beam</span><span class="p">(</span><span class="n">beam</span><span class="o">=</span><span class="n">beam</span><span class="p">,</span> <span class="o">**</span><span class="n">beam_kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotAstroData.add_segment">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAstroData.add_segment">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_segment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ampfits</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">angfits</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">Ufits</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Qfits</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">xskip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">yskip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                    <span class="n">amp</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">ang</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">stU</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">stQ</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">ampfactor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">angonly</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                    <span class="n">rotation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span>
                    <span class="n">cutoff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use Axes.quiver of matplotlib. kwargs must include the arguments of AstroData to specify the data to be plotted. fitsimage = [ampfits, angfits, Ufits, Qfits]. data = [amp, ang, stU, stQ]. kwargs may include arguments for add_beam() and a dict of beam_kwargs to specify the beam patch in more detail.</span>

<span class="sd">        Args:</span>
<span class="sd">            ampfits (str, optional): In put fits name. Length of segment. Defaults to None.</span>
<span class="sd">            angfits (str, optional): In put fits name. North to east. Defaults to None.</span>
<span class="sd">            Ufits (str, optional): In put fits name. Stokes U. Defaults to None.</span>
<span class="sd">            Qfits (str, optional): In put fits name. Stokes Q. Defaults to None.</span>
<span class="sd">            xskip, yskip (int, optional): Spatial pixel skip. Defaults to 1.</span>
<span class="sd">            amp (list, optional): Length of segment. Defaults to None.</span>
<span class="sd">            ang (list, optional): North to east. Defaults to None.</span>
<span class="sd">            stU (list, optional): Stokes U. Defaults to None.</span>
<span class="sd">            stQ (list, optional): Stokes Q. Defaults to None.</span>
<span class="sd">            ampfactor (float, optional): Length of segment is amp times ampfactor. Defaults to 1..</span>
<span class="sd">            angonly (bool, optional): True means amp=1 for all. Defaults to False.</span>
<span class="sd">            rotation (float, optional): Segment angle is ang + rotation. Defaults to 0..</span>
<span class="sd">            cutoff (float, optional): Used when amp and ang are calculated from Stokes U and Q. In the unit of sigma. Defaults to 3..</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;angles&#39;</span><span class="p">:</span> <span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="s1">&#39;scale_units&#39;</span><span class="p">:</span> <span class="s1">&#39;xy&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;gray&#39;</span><span class="p">,</span>
               <span class="s1">&#39;pivot&#39;</span><span class="p">:</span> <span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="s1">&#39;headwidth&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;headlength&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
               <span class="s1">&#39;headaxislength&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;width&#39;</span><span class="p">:</span> <span class="mf">0.007</span><span class="p">,</span> <span class="s1">&#39;zorder&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
        <span class="n">beam_kwargs</span> <span class="o">=</span> <span class="n">kwargs2beamargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">amp</span><span class="p">,</span> <span class="n">ang</span><span class="p">,</span> <span class="n">stU</span><span class="p">,</span> <span class="n">stQ</span><span class="p">]</span>
        <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;fitsimage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ampfits</span><span class="p">,</span> <span class="n">angfits</span><span class="p">,</span> <span class="n">Ufits</span><span class="p">,</span> <span class="n">Qfits</span><span class="p">]</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">kwargs2AstroData</span><span class="p">(</span><span class="n">_kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">xskip</span><span class="p">,</span> <span class="n">yskip</span><span class="p">)</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">beam</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">beam</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">sigma</span>
        <span class="n">amp</span><span class="p">,</span> <span class="n">ang</span><span class="p">,</span> <span class="n">stU</span><span class="p">,</span> <span class="n">stQ</span> <span class="o">=</span> <span class="n">c</span>
        <span class="n">sigmaU</span><span class="p">,</span> <span class="n">sigmaQ</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
        <span class="n">beam</span> <span class="o">=</span> <span class="p">[</span><span class="n">beam</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="k">if</span> <span class="n">beam</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beam</span> <span class="o">=</span> <span class="n">beam</span>
        <span class="k">if</span> <span class="n">stU</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">stQ</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigmaU</span> <span class="o">+</span> <span class="n">sigmaQ</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
            <span class="n">ang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">stU</span><span class="p">,</span> <span class="n">stQ</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
            <span class="n">amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hypot</span><span class="p">(</span><span class="n">stU</span><span class="p">,</span> <span class="n">stQ</span><span class="p">)</span>
            <span class="n">amp</span><span class="p">[</span><span class="n">amp</span> <span class="o">&lt;</span> <span class="n">cutoff</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">if</span> <span class="n">amp</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">angonly</span><span class="p">:</span>
            <span class="n">amp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">amp</span> <span class="o">=</span> <span class="n">amp</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="n">ampfactor</span> <span class="o">*</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">ang</span> <span class="o">+</span> <span class="n">rotation</span><span class="p">))</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">ampfactor</span> <span class="o">*</span> <span class="n">amp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">ang</span> <span class="o">+</span> <span class="n">rotation</span><span class="p">))</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vskipfill</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vskipfill</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">U</span> <span class="o">=</span> <span class="p">[</span><span class="n">U</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span><span class="p">]]</span>
            <span class="n">V</span> <span class="o">=</span> <span class="p">[</span><span class="n">V</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">channelnumber</span><span class="p">]]</span>
        <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">axnow</span><span class="p">,</span> <span class="n">unow</span><span class="p">,</span> <span class="n">vnow</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">):</span>
            <span class="n">axnow</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">unow</span><span class="p">,</span> <span class="n">vnow</span><span class="p">,</span> <span class="o">**</span><span class="n">_kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_beam</span><span class="p">(</span><span class="n">beam</span><span class="o">=</span><span class="n">beam</span><span class="p">,</span> <span class="o">**</span><span class="n">beam_kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotAstroData.add_rgb">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAstroData.add_rgb">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_rgb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xskip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">yskip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">stretch</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
                <span class="n">stretchscale</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span>
                <span class="n">stretchpower</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use PIL.Image and imshow of matplotlib. kwargs must include the arguments of AstroData to specify the data to be plotted. A three-element array ([red, green, blue]) is supposed for all arguments, except for xskip, yskip and show_beam, including vmax and vmin. kwargs may include arguments for add_beam() and a dict of beam_kwargs to specify the beam patch in more detail.</span>

<span class="sd">        Args:</span>
<span class="sd">            xskip, yskip (int, optional): Spatial pixel skip. Defaults to 1.</span>
<span class="sd">            stretch (str, optional): &#39;log&#39; means the mapped data are logarithmic. &#39;asinh&#39; means the mapped data are arc sin hyperbolic. &#39;power&#39; means the mapped data are power-law (see also stretchpower). Defaults to &#39;linear&#39;.</span>
<span class="sd">            stretchscale (float, optional): color scale is asinh(data / stretchscale). Defaults to None.</span>
<span class="sd">            stretchpower (float, optional): color scale is ((data / vmin)**(1 - stretchpower) - 1) / (1 - stretchpower) / ln(10). 0 means the linear scale. 1 means the logarithmic scale. Defaults to 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">PIL</span><span class="w"> </span><span class="kn">import</span> <span class="n">Image</span>

        <span class="n">_kw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">beam_kwargs</span> <span class="o">=</span> <span class="n">kwargs2beamargs</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">kwargs2AstroData</span><span class="p">(</span><span class="n">_kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">xskip</span><span class="p">,</span> <span class="n">yskip</span><span class="p">)</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">beam</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">beam</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">sigma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beam</span> <span class="o">=</span> <span class="n">beam</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sigma</span> <span class="o">=</span> <span class="n">sigma</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">stretchscale</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">stretchscale</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">stretchscale</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigma</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">set_minmax</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">stretch</span><span class="p">,</span> <span class="n">stretchscale</span><span class="p">,</span> <span class="n">stretchpower</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">_kw</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">])):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RGB shapes mismatch. Skip add_rgb.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">cmin</span><span class="p">,</span> <span class="n">cmax</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;vmin&#39;</span><span class="p">],</span> <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;vmax&#39;</span><span class="p">])):</span>
            <span class="k">if</span> <span class="n">cmax</span> <span class="o">&gt;</span> <span class="n">cmin</span><span class="p">:</span>
                <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">cmin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">cmax</span> <span class="o">-</span> <span class="n">cmin</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span>
            <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vskipfill</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">v</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ydir</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">xdir</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">axnow</span><span class="p">,</span> <span class="n">rgb</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;RGB&#39;</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">size</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">rgb</span><span class="p">)</span>
                    <span class="n">im</span><span class="o">.</span><span class="n">putpixel</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
            <span class="n">axnow</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
            <span class="n">axnow</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_beam</span><span class="p">(</span><span class="n">beam</span><span class="o">=</span><span class="n">beam</span><span class="p">,</span> <span class="o">**</span><span class="n">beam_kwargs</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_set_axis_shared</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pa2</span><span class="p">:</span> <span class="n">PlotAxes2D</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal method used in set_axis() and set_axis_radec().</span>

<span class="sd">        Args:</span>
<span class="sd">            pa2 (PlotAxes2D): This is instantiated in set_axis() or set_axis_radec().</span>
<span class="sd">            title (dict | str | None): str means set_title(str) for 2D or fig.suptitle(str) for 3D. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">ch</span><span class="p">,</span> <span class="n">axnow</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">):</span>
            <span class="n">pa2</span><span class="o">.</span><span class="n">set_xyaxes</span><span class="p">(</span><span class="n">axnow</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Xlim</span> <span class="o">=</span> <span class="n">pa2</span><span class="o">.</span><span class="n">xlim</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ylim</span> <span class="o">=</span> <span class="n">pa2</span><span class="o">.</span><span class="n">ylim</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">ch</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">bottomleft</span><span class="p">):</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axnow</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">axnow</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">axnow</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="n">axnow</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">}</span>
                <span class="n">t_in</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">}</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="k">else</span> <span class="n">title</span>
                <span class="n">t</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">t_in</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npages</span><span class="p">):</span>
                    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="o">**</span><span class="n">t</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">}</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="k">else</span> <span class="n">title</span>
                <span class="n">axnow</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="o">**</span><span class="n">t</span><span class="p">)</span>

<div class="viewcode-block" id="PlotAstroData.set_axis">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAstroData.set_axis">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use Axes.set_* of matplotlib. kwargs can include the arguments of PlotAxes2D to adjust x and y axis.</span>

<span class="sd">        Args:</span>
<span class="sd">            title (dict | str | None): str means set_title(str) for 2D or fig.suptitle(str) for 3D. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_kw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">offunit</span> <span class="o">=</span> <span class="s1">&#39;(arcsec)&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dist</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;(au)&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pv</span><span class="p">:</span>
            <span class="n">offlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Offset </span><span class="si">{</span><span class="n">offunit</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">vellabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Velocity (km s$^{-1})$&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;xlabel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_kw</span><span class="p">:</span>
                <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">vellabel</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">swapxy</span> <span class="k">else</span> <span class="n">offlabel</span>
            <span class="k">if</span> <span class="s1">&#39;ylabel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_kw</span><span class="p">:</span>
                <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;ylabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offlabel</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">swapxy</span> <span class="k">else</span> <span class="n">vellabel</span>
            <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;samexy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ralabel</span><span class="p">,</span> <span class="n">declabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;R.A. </span><span class="si">{</span><span class="n">offunit</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Dec. </span><span class="si">{</span><span class="n">offunit</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;xlabel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_kw</span><span class="p">:</span>
                <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">declabel</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">swapxy</span> <span class="k">else</span> <span class="n">ralabel</span>
            <span class="k">if</span> <span class="s1">&#39;ylabel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_kw</span><span class="p">:</span>
                <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;ylabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ralabel</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">swapxy</span> <span class="k">else</span> <span class="n">declabel</span>
        <span class="k">if</span> <span class="s1">&#39;xlim&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_kw</span><span class="p">:</span>
            <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Xlim</span>
        <span class="k">if</span> <span class="s1">&#39;ylim&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_kw</span><span class="p">:</span>
            <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;ylim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ylim</span>
        <span class="n">pa2</span> <span class="o">=</span> <span class="n">kwargs2PlotAxes2D</span><span class="p">(</span><span class="n">_kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_axis_shared</span><span class="p">(</span><span class="n">pa2</span><span class="o">=</span><span class="n">pa2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotAstroData.set_axis_radec">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAstroData.set_axis_radec">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_axis_radec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                       <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;R.A. (ICRS)&#39;</span><span class="p">,</span>
                       <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Dec. (ICRS)&#39;</span><span class="p">,</span>
                       <span class="n">nticksminor</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
                       <span class="n">grid</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use Axes.set_* of matplotlib. kwargs can include the arguments of PlotAxes2D to adjust x and y axis.</span>

<span class="sd">        Args:</span>
<span class="sd">            center (str, optional): Defaults to None, initial one.</span>
<span class="sd">            xlabel (str, optional): Defaults to &#39;R.A. (ICRS)&#39;.</span>
<span class="sd">            ylabel (str, optional): Defaults to &#39;Dec. (ICRS)&#39;.</span>
<span class="sd">            nticksminor (int, optional): Interval ratio of major and minor ticks. Defaults to 2.</span>
<span class="sd">            grid (dict, optional): True means merely grid(). Defaults to None.</span>
<span class="sd">            title (dict | str | None): str means set_title(str) for 2D or fig.suptitle(str) for 3D. Defaults to None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span>
        <span class="k">if</span> <span class="n">center</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">center</span> <span class="o">=</span> <span class="s1">&#39;00h00m00s 00d00m00s&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">csplit</span> <span class="o">:=</span> <span class="n">center</span><span class="o">.</span><span class="n">split</span><span class="p">())</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">center</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">csplit</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">csplit</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_sec</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_min</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
            <span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;h&#39;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s1">&#39;d&#39;</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">s</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_hmdm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;m&#39;</span>

        <span class="n">on_min_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmax</span> <span class="o">&gt;=</span> <span class="mf">60.0</span>
        <span class="k">if</span> <span class="n">on_min_scale</span><span class="p">:</span>
            <span class="n">ra_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">get_sec</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span>
            <span class="n">dec_s</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">ra</span> <span class="o">=</span> <span class="n">get_hmdm</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ra_s</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">s&#39;</span>
            <span class="n">dec</span> <span class="o">=</span> <span class="n">get_hmdm</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dec_s</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1">s&#39;</span>
            <span class="n">center</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ra</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">dec</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="n">dec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">coord2xy</span><span class="p">(</span><span class="n">center</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">log2r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">2.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">rmax</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">makegrid</span><span class="p">(</span><span class="n">second</span><span class="p">,</span> <span class="n">mode</span><span class="p">):</span>
            <span class="n">second</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">second</span><span class="p">)</span>
            <span class="n">is_dec</span> <span class="o">=</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;dec&#39;</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="k">if</span> <span class="n">is_dec</span> <span class="k">else</span> <span class="mf">1.5</span>
            <span class="n">factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">is_dec</span> <span class="k">else</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">dec</span><span class="p">)</span>
            <span class="n">no_sec</span> <span class="o">=</span> <span class="n">on_min_scale</span> <span class="ow">and</span> <span class="n">is_dec</span>
            <span class="k">if</span> <span class="n">no_sec</span><span class="p">:</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$^{\prime}$&#39;</span> <span class="k">if</span> <span class="n">is_dec</span> <span class="k">else</span> <span class="sa">r</span><span class="s1">&#39;$^\mathrm</span><span class="si">{m}</span><span class="s1">$&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$^{\prime\prime}$&#39;</span> <span class="k">if</span> <span class="n">is_dec</span> <span class="k">else</span> <span class="sa">r</span><span class="s1">&#39;$^\mathrm</span><span class="si">{s}</span><span class="s1">$&#39;</span>
                <span class="n">unit</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;.$\hspace{-0.4}$&#39;</span> <span class="o">+</span> <span class="n">unit</span>
            <span class="n">dorder</span> <span class="o">=</span> <span class="n">log2r</span> <span class="o">-</span> <span class="n">scale</span> <span class="o">-</span> <span class="p">(</span><span class="n">order</span> <span class="o">:=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">log2r</span> <span class="o">-</span> <span class="n">scale</span><span class="p">))</span>
            <span class="k">if</span> <span class="mf">0.00</span> <span class="o">&lt;</span> <span class="n">dorder</span> <span class="o">&lt;=</span> <span class="mf">0.33</span><span class="p">:</span>
                <span class="n">g</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="mf">0.33</span> <span class="o">&lt;</span> <span class="n">dorder</span> <span class="o">&lt;=</span> <span class="mf">0.68</span><span class="p">:</span>
                <span class="n">g</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="mf">0.68</span> <span class="o">&lt;</span> <span class="n">dorder</span> <span class="o">&lt;=</span> <span class="mf">1.00</span><span class="p">:</span>
                <span class="n">g</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">g</span> <span class="o">*=</span> <span class="mi">10</span><span class="o">**</span><span class="n">order</span>
            <span class="n">decimals</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="n">order</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">rounded</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">second</span><span class="p">,</span> <span class="n">decimals</span><span class="p">)</span>
            <span class="n">lastdigit</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">rounded</span> <span class="o">//</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">decimals</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">%</span> <span class="mi">10</span>
            <span class="n">rounded</span> <span class="o">-=</span> <span class="n">lastdigit</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="n">decimals</span><span class="p">)</span> <span class="o">%</span> <span class="n">g</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="n">g</span> <span class="o">-</span> <span class="n">second</span> <span class="o">+</span> <span class="n">rounded</span><span class="p">)</span> <span class="o">*</span> <span class="n">factor</span>
            <span class="n">ticksminor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">ticks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ticks</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">6</span><span class="o">*</span><span class="n">nticksminor</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">decimals</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">decimals</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;ra&#39;</span><span class="p">:</span>
                <span class="n">xy</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="p">[</span><span class="n">ticks</span> <span class="o">/</span> <span class="mf">3600.</span><span class="p">,</span> <span class="n">ticks</span> <span class="o">*</span> <span class="mi">0</span><span class="p">],</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xy</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="p">[</span><span class="n">ticks</span> <span class="o">*</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ticks</span> <span class="o">/</span> <span class="mf">3600.</span><span class="p">],</span> <span class="mi">1</span>
            <span class="n">tickvalues</span> <span class="o">=</span> <span class="n">xy2coord</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">center</span><span class="p">)</span>
            <span class="n">_get</span> <span class="o">=</span> <span class="n">get_min</span> <span class="k">if</span> <span class="n">no_sec</span> <span class="k">else</span> <span class="n">get_sec</span>
            <span class="n">tickvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">float</span><span class="p">(</span><span class="n">_get</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tickvalues</span><span class="p">])</span>
            <span class="n">tickvalues</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">divmod</span><span class="p">(</span><span class="n">tickvalues</span> <span class="o">+</span> <span class="mf">1e-7</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">tickvalues</span> <span class="o">=</span> <span class="p">(</span><span class="n">tickvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">60</span><span class="p">,</span> <span class="n">tickvalues</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">ticklabels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="si">:</span><span class="s1">02d</span><span class="si">}{</span><span class="n">unit</span><span class="si">}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">j</span><span class="si">:</span><span class="s1">.</span><span class="si">{</span><span class="n">decimals</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span>
                          <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">tickvalues</span><span class="p">)]</span>
            <span class="k">return</span> <span class="n">ticks</span><span class="p">,</span> <span class="n">ticksminor</span><span class="p">,</span> <span class="n">ticklabels</span>

        <span class="n">ra_s</span> <span class="o">=</span> <span class="n">get_sec</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">dec_s</span> <span class="o">=</span> <span class="n">get_sec</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">xticks</span><span class="p">,</span> <span class="n">xticksminor</span><span class="p">,</span> <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">makegrid</span><span class="p">(</span><span class="n">ra_s</span><span class="p">,</span> <span class="s1">&#39;ra&#39;</span><span class="p">)</span>
        <span class="n">yticks</span><span class="p">,</span> <span class="n">yticksminor</span><span class="p">,</span> <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">makegrid</span><span class="p">(</span><span class="n">dec_s</span><span class="p">,</span> <span class="s1">&#39;dec&#39;</span><span class="p">)</span>
        <span class="n">ra_hm</span> <span class="o">=</span> <span class="n">get_hmdm</span><span class="p">(</span><span class="n">xy2coord</span><span class="p">([</span><span class="n">xticks</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mf">3600.</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">center</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">dec_dm</span> <span class="o">=</span> <span class="n">get_hmdm</span><span class="p">(</span><span class="n">xy2coord</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">yticks</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">/</span> <span class="mf">3600.</span><span class="p">],</span> <span class="n">center</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">on_min_scale</span><span class="p">:</span>
            <span class="n">dec_dm</span> <span class="o">=</span> <span class="n">dec_dm</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;d&#39;</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;$^\mathrm</span><span class="si">{h}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;$^\mathrm</span><span class="si">{m}</span><span class="s1">$&#39;</span><span class="p">}</span>
        <span class="n">ra_hm</span> <span class="o">=</span> <span class="n">ra_hm</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="n">trans</span><span class="p">))</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;d&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;$^{\circ}$&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span> <span class="sa">r</span><span class="s1">&#39;$^{\prime}$&#39;</span><span class="p">}</span>
        <span class="n">dec_dm</span> <span class="o">=</span> <span class="n">dec_dm</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">maketrans</span><span class="p">(</span><span class="n">trans</span><span class="p">))</span>
        <span class="n">xticklabels</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">ra_hm</span> <span class="o">+</span> <span class="n">xticklabels</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">yticklabels</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">dec_dm</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">yticklabels</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">pa2</span> <span class="o">=</span> <span class="n">PlotAxes2D</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Xlim</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ylim</span><span class="p">,</span>
                         <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xticks</span><span class="p">,</span> <span class="n">yticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="p">,</span>
                         <span class="n">yticklabels</span><span class="p">,</span> <span class="n">xticksminor</span><span class="p">,</span> <span class="n">yticksminor</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_axis_shared</span><span class="p">(</span><span class="n">pa2</span><span class="o">=</span><span class="n">pa2</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlotAstroData.savefig">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAstroData.savefig">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">savefig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Use savefig of matplotlib.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str, optional): Output image file name. Defaults to None.</span>
<span class="sd">            show (bool, optional): True means doing plt.show(). Defaults to False.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;transparent&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;bbox_inches&#39;</span><span class="p">:</span> <span class="s1">&#39;tight&#39;</span><span class="p">}</span>
        <span class="n">_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">axnow</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">:</span>
            <span class="n">axnow</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Xlim</span><span class="p">)</span>
            <span class="n">axnow</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Ylim</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">ext</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npages</span><span class="p">):</span>
                <span class="n">ver</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">npages</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s1">d</span><span class="si">}</span><span class="s1">&#39;</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ver</span><span class="si">}</span><span class="s1">.</span><span class="si">{</span><span class="n">ext</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="o">**</span><span class="n">_kw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>


<div class="viewcode-block" id="PlotAstroData.get_figax">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.PlotAstroData.get_figax">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_figax</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">object</span><span class="p">,</span> <span class="nb">object</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Output the external fig and ax after plotting.</span>

<span class="sd">        Returns:</span>
<span class="sd">            tuple: (fig, ax)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;get_figax is not supported with channel maps&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">fig</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>
</div>



<div class="viewcode-block" id="plotprofile">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.plotprofile">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plotprofile</span><span class="p">(</span><span class="n">coords</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="nb">str</span> <span class="o">=</span> <span class="p">[],</span>
                <span class="n">xlist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">ylist</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
                <span class="n">ellipse</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">ninterp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">flux</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">width</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">gaussfit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gauss_kwargs</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
                <span class="n">title</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                <span class="n">dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">vsys</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span>
                <span class="n">nrows</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ncols</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">getfigax</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                <span class="n">savefig</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">object</span><span class="p">,</span> <span class="nb">object</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use Axes.plot of matplotlib to plot line profiles at given coordinates. kwargs must include the arguments of AstroData to specify the data to be plotted. kwargs can include the arguments of PlotAxes2D to adjust x and y axes.</span>

<span class="sd">    Args:</span>
<span class="sd">        coords (list, optional): Coordinates. Defaults to [].</span>
<span class="sd">        xlist (list, optional): Offset from the center. Defaults to [].</span>
<span class="sd">        ylist (list, optional): Offset from the center. Defaults to [].</span>
<span class="sd">        ellipse (list, optional): [major, minor, pa], For average. Defaults to None.</span>
<span class="sd">        ninterp (int, optional): Number of points for interpolation. Defaults to 1.</span>
<span class="sd">        flux (bool, optional): y axis is flux density. Defaults to False.</span>
<span class="sd">        width (int, optional): Rebinning step along v. Defaults to 1.</span>
<span class="sd">        gaussfit (bool, optional): Fit the profiles. Defaults to False.</span>
<span class="sd">        gauss_kwargs (dict, optional): Kwargs for Axes.plot. Defaults to {}.</span>
<span class="sd">        title (list, optional): For each plot. Defaults to None.</span>
<span class="sd">        text (list, optional): For each plot. Defaults to None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: (fig, ax), where ax is a list, if getfigax=True. Otherwise, no return.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;drawstyle&#39;</span><span class="p">:</span> <span class="s1">&#39;steps-mid&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;k&#39;</span><span class="p">}</span>
    <span class="n">_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">_kwgauss</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;drawstyle&#39;</span><span class="p">:</span> <span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;g&#39;</span><span class="p">}</span>
    <span class="n">_kwgauss</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">gauss_kwargs</span><span class="p">)</span>
    <span class="n">savefig0</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bbox_inches&#39;</span><span class="p">:</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="s1">&#39;transparent&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">coords</span><span class="p">]</span>
    <span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;xlim&#39;</span> <span class="ow">in</span> <span class="n">_kw</span> <span class="k">else</span> <span class="p">[</span><span class="o">-</span><span class="mf">1e10</span><span class="p">,</span> <span class="mf">1e10</span><span class="p">]</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">AstroFrame</span><span class="p">(</span><span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span> <span class="n">vsys</span><span class="o">=</span><span class="n">vsys</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">kwargs2AstroData</span><span class="p">(</span><span class="n">_kw</span><span class="p">)</span>
    <span class="n">Tb</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">Tb</span>
    <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="n">d</span><span class="o">.</span><span class="n">binning</span><span class="p">([</span><span class="n">width</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">v</span><span class="p">,</span> <span class="n">prof</span><span class="p">,</span> <span class="n">gfitres</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">profile</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="n">coords</span><span class="p">,</span> <span class="n">xlist</span><span class="o">=</span><span class="n">xlist</span><span class="p">,</span> <span class="n">ylist</span><span class="o">=</span><span class="n">ylist</span><span class="p">,</span>
                                 <span class="n">ellipse</span><span class="o">=</span><span class="n">ellipse</span><span class="p">,</span> <span class="n">ninterp</span><span class="o">=</span><span class="n">ninterp</span><span class="p">,</span>
                                 <span class="n">flux</span><span class="o">=</span><span class="n">flux</span><span class="p">,</span> <span class="n">gaussfit</span><span class="o">=</span><span class="n">gaussfit</span><span class="p">)</span>
    <span class="n">nprof</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">prof</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;ylabel&#39;</span> <span class="ow">in</span> <span class="n">_kw</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;ylabel&#39;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">Tb</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$T_b$ (K)&#39;</span>
    <span class="k">elif</span> <span class="n">flux</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;Flux (Jy)&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">bunit</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="p">[</span><span class="n">ylabel</span><span class="p">]</span> <span class="o">*</span> <span class="n">nprof</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">gauss</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">p</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">4.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span> <span class="o">*</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="n">w</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">set_rcparams</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ncols</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="n">nprof</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">ncols</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">nrows</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">nprof</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;External ax is supported only when len(coords)=1.&#39;</span><span class="p">)</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">nprof</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">ax</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;xlabel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_kw</span><span class="p">:</span>
        <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Velocity (km s$^{-1}$)&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;xlim&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_kw</span><span class="p">:</span>
        <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">v</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
    <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;samexy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">pa2d</span> <span class="o">=</span> <span class="n">kwargs2PlotAxes2D</span><span class="p">(</span><span class="n">_kw</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nprof</span><span class="p">):</span>
        <span class="n">sharex</span> <span class="o">=</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nrows</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="n">sharex</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gaussfit</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">gauss</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="o">*</span><span class="n">gfitres</span><span class="p">[</span><span class="s1">&#39;best&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span> <span class="o">**</span><span class="n">_kwgauss</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">prof</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">**</span><span class="n">_kw</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hlines</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">v</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">pa2d</span><span class="o">.</span><span class="n">set_xyaxes</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">**</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">title</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
                <span class="n">title</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">title</span><span class="p">[</span><span class="n">i</span><span class="p">]}</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="o">**</span><span class="n">title</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="n">nprof</span> <span class="o">-</span> <span class="n">ncols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">visible</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">getfigax</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">savefig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fname&#39;</span><span class="p">:</span> <span class="n">savefig</span><span class="p">}</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">savefig</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="k">else</span> <span class="n">savefig</span>
        <span class="n">savefig0</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="o">**</span><span class="n">savefig0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plotslice">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.plotslice">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plotslice</span><span class="p">(</span><span class="n">length</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">dx</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">pa</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
              <span class="n">dist</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">xoff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">yoff</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
              <span class="n">xflip</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">yflip</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
              <span class="n">txtfile</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
              <span class="n">fig</span><span class="p">:</span> <span class="nb">object</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="nb">object</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
              <span class="n">getfigax</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
              <span class="n">savefig</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
              <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use Axes.plot of matplotlib to plot a 1D spatial slice in a 2D map. kwargs must include the arguments of AstroData to specify the data to be plotted. kwargs can include the arguments of PlotAxes2D to adjust x and y axes.</span>

<span class="sd">    Args:</span>
<span class="sd">        length (float): Slice length.</span>
<span class="sd">        dx (float, optional): Grid increment. Defaults to None.</span>
<span class="sd">        pa (float, optional): Degree. Position angle. Defaults to 0.</span>
<span class="sd">        fitsimage to show: same as in PlotAstroData.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;linestyle&#39;</span><span class="p">:</span> <span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;marker&#39;</span><span class="p">:</span> <span class="s1">&#39;o&#39;</span><span class="p">}</span>
    <span class="n">_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">savefig0</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bbox_inches&#39;</span><span class="p">:</span> <span class="s1">&#39;tight&#39;</span><span class="p">,</span> <span class="s1">&#39;transparent&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
    <span class="n">center</span> <span class="o">=</span> <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;center&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;center&#39;</span> <span class="ow">in</span> <span class="n">_kw</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">AstroFrame</span><span class="p">(</span><span class="n">rmax</span><span class="o">=</span><span class="n">length</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="n">dist</span><span class="p">,</span> <span class="n">xoff</span><span class="o">=</span><span class="n">xoff</span><span class="p">,</span> <span class="n">yoff</span><span class="o">=</span><span class="n">yoff</span><span class="p">,</span>
                   <span class="n">xflip</span><span class="o">=</span><span class="n">xflip</span><span class="p">,</span> <span class="n">yflip</span><span class="o">=</span><span class="n">yflip</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="n">center</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">kwargs2AstroData</span><span class="p">(</span><span class="n">_kw</span><span class="p">)</span>
    <span class="n">Tb</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">Tb</span>
    <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Only 2D map is supported.&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="n">r</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="n">length</span><span class="p">,</span> <span class="n">pa</span><span class="o">=</span><span class="n">pa</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="n">dx</span><span class="p">)</span>
    <span class="n">xunit</span> <span class="o">=</span> <span class="s1">&#39;arcsec&#39;</span> <span class="k">if</span> <span class="n">dist</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="s1">&#39;au&#39;</span>
    <span class="n">yunit</span> <span class="o">=</span> <span class="s1">&#39;K&#39;</span> <span class="k">if</span> <span class="n">Tb</span> <span class="k">else</span> <span class="n">d</span><span class="o">.</span><span class="n">bunit</span>
    <span class="n">yquantity</span> <span class="o">=</span> <span class="s1">&#39;Tb&#39;</span> <span class="k">if</span> <span class="n">Tb</span> <span class="k">else</span> <span class="s1">&#39;intensity&#39;</span>

    <span class="k">if</span> <span class="n">txtfile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">txtfile</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">c_</span><span class="p">[</span><span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">],</span>
                   <span class="n">header</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;x (</span><span class="si">{</span><span class="n">xunit</span><span class="si">}</span><span class="s1">), </span><span class="si">{</span><span class="n">yquantity</span><span class="si">}</span><span class="s1"> (</span><span class="si">{</span><span class="n">yunit</span><span class="si">}</span><span class="s1">); &#39;</span>
                   <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;positive x is pa=</span><span class="si">{</span><span class="n">pa</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> deg.&#39;</span><span class="p">)</span>
    <span class="n">set_rcparams</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;xlabel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_kw</span><span class="p">:</span>
        <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Offset (</span><span class="si">{</span><span class="n">xunit</span><span class="si">}</span><span class="s1">)&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;ylabel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_kw</span><span class="p">:</span>
        <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;ylabel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;Intensity (</span><span class="si">{</span><span class="n">yunit</span><span class="si">}</span><span class="s1">)&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;xlim&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">_kw</span><span class="p">:</span>
        <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;xlim&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">r</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
    <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;samexy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">pa2d</span> <span class="o">=</span> <span class="n">kwargs2PlotAxes2D</span><span class="p">(</span><span class="n">_kw</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="o">**</span><span class="n">_kw</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">sigma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r</span> <span class="o">*</span> <span class="mi">0</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">d</span><span class="o">.</span><span class="n">sigma</span><span class="p">,</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
    <span class="n">pa2d</span><span class="o">.</span><span class="n">set_xyaxes</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">getfigax</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">savefig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fname&#39;</span><span class="p">:</span> <span class="n">savefig</span><span class="p">}</span> <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">savefig</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="k">else</span> <span class="n">savefig</span>
        <span class="n">savefig0</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="o">**</span><span class="n">savefig0</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>



<div class="viewcode-block" id="plot3d">
<a class="viewcode-back" href="../../plotastrodata.html#plotastrodata.plot_utils.plot3d">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">plot3d</span><span class="p">(</span><span class="n">levels</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">],</span>
           <span class="n">cmap</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Jet&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.08</span><span class="p">,</span>
           <span class="n">xlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;R.A. (arcsec)&#39;</span><span class="p">,</span>
           <span class="n">ylabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Dec. (arcsec)&#39;</span><span class="p">,</span>
           <span class="n">vlabel</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Velocity (km/s)&#39;</span><span class="p">,</span>
           <span class="n">xskip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">yskip</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
           <span class="n">eye_p</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">eye_i</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">180</span><span class="p">,</span>
           <span class="n">xplus</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">xminus</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
           <span class="n">yplus</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">yminus</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
           <span class="n">vplus</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span> <span class="n">vminus</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
           <span class="n">outname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;plot3d&#39;</span><span class="p">,</span> <span class="n">show</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
           <span class="n">return_data_layout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
           <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use Plotly. kwargs must include the arguments of AstroData to specify the data to be plotted. kwargs must include the arguments of AstroFrame to specify the ranges and so on for plotting.</span>

<span class="sd">    Args:</span>
<span class="sd">        levels (list, optional): Contour levels. Defaults to [3,6,12].</span>
<span class="sd">        cmap (str, optional): Color map name. Defaults to &#39;Jet&#39;.</span>
<span class="sd">        alpha (float, optional): opacity in plotly. Defaults to 0.08.</span>
<span class="sd">        xlabel (str, optional): Defaults to &#39;R.A. (arcsec)&#39;.</span>
<span class="sd">        ylabel (str, optional): Defaults to &#39;Dec. (arcsec)&#39;.</span>
<span class="sd">        vlabel (str, optional): Defaults to &#39;Velocity (km/s)&#39;.</span>
<span class="sd">        xskip (int, optional): Number of pixel to skip. Defaults to 1.</span>
<span class="sd">        yskip (int, optional): Number of pixel to skip. Defaults to 1.</span>
<span class="sd">        eye_p (float, optional): Azimuthal angle of camera. Defaults to 0.</span>
<span class="sd">        eye_i (float, optional): Inclination angle of camera. Defaults to 180.</span>
<span class="sd">        xplus (dict, optional): 2D data to be plotted on the y-v plane at the positive edge of x. This dictionary must have a key of data and can have keys of levels, sigma, cmap, and alpha. Defaults to {}.</span>
<span class="sd">        xminus (dict, optional): See xplus. Defaults to {}.</span>
<span class="sd">        yplus (dict, optional): See xplus. Defaults to {}.</span>
<span class="sd">        yminus (dict, optional): See xplus. Defaults to {}.</span>
<span class="sd">        vplus (dict, optional): See xplus. Defaults to {}.</span>
<span class="sd">        vminus (dict, optional): See xplus. Defaults to {}.</span>
<span class="sd">        outname (str, optional): Output file name. Defaults to &#39;plot3d&#39;.</span>
<span class="sd">        show (bool, optional): auto_play in plotly. Defaults to False.</span>
<span class="sd">        return_data_layout (bool, optional): Whether to return data and layout for plotly.graph_objs.Figure. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: {&#39;data&#39;: data, &#39;layout&#39;: layout}, if return_data_layout=True. Otherwise, no return.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">plotly.graph_objs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">go</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">skimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">measure</span>

    <span class="n">f</span> <span class="o">=</span> <span class="n">kwargs2AstroFrame</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">kwargs2AstroData</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">xskip</span><span class="p">,</span> <span class="n">yskip</span><span class="p">)</span>
    <span class="n">volume</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">v</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">sigma</span>
    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dv</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">volume</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">volume</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">dx</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">volume</span> <span class="o">=</span> <span class="n">x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">dx</span><span class="p">,</span> <span class="n">volume</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">dy</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">volume</span> <span class="o">=</span> <span class="n">y</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">dy</span><span class="p">,</span> <span class="n">volume</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">if</span> <span class="n">dv</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">v</span><span class="p">,</span> <span class="n">dv</span><span class="p">,</span> <span class="n">volume</span> <span class="o">=</span> <span class="n">v</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">dv</span><span class="p">,</span> <span class="n">volume</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
    <span class="n">s</span><span class="p">,</span> <span class="n">ds</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">v</span><span class="p">],</span> <span class="p">[</span><span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dv</span><span class="p">]</span>
    <span class="n">deg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">xeye</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">eye_i</span> <span class="o">*</span> <span class="n">deg</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">eye_p</span> <span class="o">*</span> <span class="n">deg</span><span class="p">)</span>
    <span class="n">yeye</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">eye_i</span> <span class="o">*</span> <span class="n">deg</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">eye_p</span> <span class="o">*</span> <span class="n">deg</span><span class="p">)</span>
    <span class="n">zeye</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">eye_i</span> <span class="o">*</span> <span class="n">deg</span><span class="p">)</span>
    <span class="n">margin</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">camera</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">eye</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xeye</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">yeye</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">zeye</span><span class="p">),</span> <span class="n">up</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">xaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">title</span><span class="o">=</span><span class="n">xlabel</span><span class="p">)</span>
    <span class="n">yaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">title</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">zaxis</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">title</span><span class="o">=</span><span class="n">vlabel</span><span class="p">)</span>
    <span class="n">scene</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">aspectmode</span><span class="o">=</span><span class="s1">&#39;cube&#39;</span><span class="p">,</span> <span class="n">camera</span><span class="o">=</span><span class="n">camera</span><span class="p">,</span>
                 <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span> <span class="n">zaxis</span><span class="o">=</span><span class="n">zaxis</span><span class="p">)</span>
    <span class="n">layout</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">margin</span><span class="o">=</span><span class="n">margin</span><span class="p">,</span> <span class="n">scene</span><span class="o">=</span><span class="n">scene</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">lev</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lev</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">volume</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">vertices</span><span class="p">,</span> <span class="n">simplices</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">marching_cubes</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">lev</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">dt</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">dt</span>
                      <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">vertices</span><span class="o">.</span><span class="n">T</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ds</span><span class="p">)]</span>
        <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">simplices</span><span class="o">.</span><span class="n">T</span>
        <span class="n">mesh</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;mesh3d&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">Xg</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Yg</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">Zg</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
                    <span class="n">intensity</span><span class="o">=</span><span class="n">Zg</span> <span class="o">*</span> <span class="mi">0</span> <span class="o">+</span> <span class="n">lev</span><span class="p">,</span>
                    <span class="n">colorscale</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">reversescale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">cmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">levels</span><span class="p">),</span> <span class="n">cmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">levels</span><span class="p">),</span>
                    <span class="n">opacity</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh</span><span class="p">)</span>
        <span class="n">Xe</span><span class="p">,</span> <span class="n">Ye</span><span class="p">,</span> <span class="n">Ze</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">vertices</span><span class="p">[</span><span class="n">simplices</span><span class="p">]:</span>
            <span class="n">Xe</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span> <span class="o">%</span> <span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="n">Ye</span> <span class="o">+=</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span> <span class="o">%</span> <span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
            <span class="n">Ze</span> <span class="o">+=</span> <span class="p">[</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dv</span> <span class="o">*</span> <span class="n">t</span><span class="p">[</span><span class="n">k</span> <span class="o">%</span> <span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;scatter3d&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">Xe</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Ye</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">Ze</span><span class="p">,</span>
                     <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.04</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                     <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;rgb(0,0,0)&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">plot_on_wall</span><span class="p">(</span><span class="n">sign</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">kwargs</span> <span class="o">==</span> <span class="p">{}:</span>
            <span class="k">return</span>

        <span class="k">match</span> <span class="n">axis</span><span class="p">:</span>
            <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:])</span>
            <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span> <span class="o">!=</span> <span class="n">shape</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The shape of the 2D data is inconsistent with the shape of the 3D data.&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">_kw</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;levels&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">192</span><span class="p">,</span> <span class="mi">384</span><span class="p">],</span>
               <span class="s1">&#39;sigma&#39;</span><span class="p">:</span> <span class="s1">&#39;hist&#39;</span><span class="p">,</span> <span class="s1">&#39;cmap&#39;</span><span class="p">:</span> <span class="s1">&#39;Jet&#39;</span><span class="p">,</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">}</span>
        <span class="n">_kw</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">volume</span> <span class="o">=</span> <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">]</span>
        <span class="n">levels</span> <span class="o">=</span> <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;levels&#39;</span><span class="p">]</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;cmap&#39;</span><span class="p">]</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">estimate_rms</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">volume</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">_kw</span><span class="p">[</span><span class="s1">&#39;sigma&#39;</span><span class="p">])</span>
        <span class="n">volume</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">volume</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sign</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">volume</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">([</span><span class="n">volume</span> <span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">volume</span> <span class="o">*</span> <span class="n">b</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">d</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">volume</span> <span class="o">=</span> <span class="n">volume</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
        <span class="k">for</span> <span class="n">lev</span> <span class="ow">in</span> <span class="n">levels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lev</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">volume</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">vertices</span><span class="p">,</span> <span class="n">simplices</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">marching_cubes</span><span class="p">(</span><span class="n">volume</span><span class="p">,</span> <span class="n">lev</span> <span class="o">*</span> <span class="n">sigma</span><span class="p">)</span>
            <span class="n">Xg</span><span class="p">,</span> <span class="n">Yg</span><span class="p">,</span> <span class="n">Zg</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">dt</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">dt</span>
                          <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">vertices</span><span class="o">.</span><span class="n">T</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">ds</span><span class="p">)]</span>
            <span class="k">match</span> <span class="n">axis</span><span class="p">:</span>
                <span class="k">case</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="n">Xg</span> <span class="o">=</span> <span class="n">Xg</span> <span class="o">*</span> <span class="mi">0</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">Yg</span> <span class="o">=</span> <span class="n">Yg</span> <span class="o">*</span> <span class="mi">0</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">Zg</span> <span class="o">=</span> <span class="n">Zg</span> <span class="o">*</span> <span class="mi">0</span> <span class="o">+</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">sign</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">simplices</span><span class="o">.</span><span class="n">T</span>
            <span class="n">mesh2d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;mesh3d&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">Xg</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Yg</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">Zg</span><span class="p">,</span>
                          <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
                          <span class="n">intensity</span><span class="o">=</span><span class="n">Zg</span> <span class="o">*</span> <span class="mi">0</span> <span class="o">+</span> <span class="n">lev</span><span class="p">,</span>
                          <span class="n">colorscale</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">reversescale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                          <span class="n">cmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">levels</span><span class="p">),</span> <span class="n">cmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">levels</span><span class="p">),</span>
                          <span class="n">opacity</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mesh2d</span><span class="p">)</span>

    <span class="n">klist</span> <span class="o">=</span> <span class="p">[</span><span class="n">xplus</span><span class="p">,</span> <span class="n">xminus</span><span class="p">,</span> <span class="n">yplus</span><span class="p">,</span> <span class="n">yminus</span><span class="p">,</span> <span class="n">vplus</span><span class="p">,</span> <span class="n">vminus</span><span class="p">]</span>
    <span class="n">slist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">alist</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">kw</span><span class="p">,</span> <span class="n">sign</span><span class="p">,</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">klist</span><span class="p">,</span> <span class="n">slist</span><span class="p">,</span> <span class="n">alist</span><span class="p">):</span>
        <span class="n">plot_on_wall</span><span class="p">(</span><span class="n">sign</span><span class="o">=</span><span class="n">sign</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">return_data_layout</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;layout&#39;</span><span class="p">:</span> <span class="n">layout</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="n">outname</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span><span class="p">,</span> <span class="n">auto_play</span><span class="o">=</span><span class="n">show</span><span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, YusukeAso.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>